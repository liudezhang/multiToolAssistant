# 功能说明（多工具助手）

## 项目定位

多工具助手是一款浏览器扩展，集合多种实用工具。当前包含**缓存助手**：指定并缓存当前页面的 `localStorage` / `sessionStorage` 字段，便于切换账号或验证不同缓存数据场景。

---

## 一、缓存助手

### 核心功能

| 功能 | 说明 |
|------|------|
| **字段监听** | 添加多个需要缓存的 storage 键名，支持 `localStorage` 与 `sessionStorage` |
| **保存配置** | 将当前页面中命中的字段值保存为一条配置，可自定义名称 |
| **恢复配置** | 一键将已保存的数据写回当前页面 storage |
| **删除配置** | 移除不需要的配置 |
| **持久化** | 监听字段与配置保存于扩展存储，浏览器重启后仍有效 |
| **按站点隔离** | 监听字段与配置按当前域名分别存储，互不干扰 |

### 使用流程

1. **打开目标网页**：在需要操作的站点打开页面
2. **点击扩展图标**：打开侧边栏，右侧显示当前站点域名
3. **添加监听的键名**：在「监听的字段」区域输入键名（如 `token`、`userinfo`），选择 `localStorage` 或 `sessionStorage`，点击「添加」
4. **刷新数据**：查看当前页面中这些键的最新值
5. **保存配置**：输入配置名称，点击「保存」，将当前快照保存为一条配置
6. **应用配置**：在「已保存的配置」中点击「应用」，将数据写回页面；通常需**刷新页面**后业务逻辑才会读取新数据

### 使用入口

- **侧边栏入口**：点击扩展图标打开侧边栏，完成字段管理、保存与恢复

### 关键说明

- 保存/恢复针对**当前激活标签页**，切换标签页后侧边栏会刷新显示新标签页的站点与数据
- 恢复后通常需**刷新页面**使业务逻辑读取新数据
- 仅作用于当前页面所属域名（**同源限制**），不同站点的配置互不影响
- 若无法连接页面，请**刷新目标网页**后重试

---

## 二、界面说明

### 首页

- 展示工具列表，点击进入对应工具
- 支持上次使用工具的记忆，下次打开侧边栏会自动跳转到上次使用的工具

### 缓存助手界面

- **当前站点**：显示当前激活标签页的域名
- **监听的字段**：添加、删除需要缓存的 storage 键名，支持选择 localStorage / sessionStorage
- **保存当前页面**：展示当前监听到的数据预览，输入名称后保存为配置
- **已保存的配置**：配置列表，支持「应用」与「删除」
- **查看详情**：可点击字段旁的查看按钮，在弹窗中查看完整 JSON 内容并复制

---

## 三、技术说明

### 数据流

1. 侧边栏请求数据 → background 转发 → content script 在页面上下文中读取 storage → 返回给侧边栏
2. 侧边栏请求写入 → background 转发 → content script 在页面上下文中写入 storage → 返回结果

### 存储策略

- **监听字段**：按域名存储在 `watchedKeysByDomain`
- **配置快照**：按域名存储在 `cacheAssistantConfigsByDomain`
- 数据保存在扩展的 `storage.local` 中，与网页的 localStorage 分离
